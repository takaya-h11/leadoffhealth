# Lead off Health 予約管理システム - テスト仕様書

**バージョン**: 1.0
**作成日**: 2025年1月23日
**対象**: MVP リリース前テスト

---

## 目次

1. [テスト環境](#1-テスト環境)
2. [テストアカウント](#2-テストアカウント)
3. [機能テスト](#3-機能テスト)
4. [統合テスト](#4-統合テスト)
5. [セキュリティテスト](#5-セキュリティテスト)
6. [パフォーマンステスト](#6-パフォーマンステスト)
7. [ユーザビリティテスト](#7-ユーザビリティテスト)

---

## 1. テスト環境

### 1.1 テスト環境構成
- **URL**: http://localhost:3000（開発環境）
- **データベース**: Supabase（テスト用プロジェクト）
- **ブラウザ**: Chrome 最新版、Safari 最新版、Edge 最新版
- **デバイス**: PC、タブレット、スマートフォン

### 1.2 テストデータ準備
- 法人データ: 3社以上
- 整体師データ: 2名以上
- 施術メニュー: 2種類以上
- 症状マスター: 4種類以上

---

## 2. テストアカウント

### 2.1 管理者アカウント
- **メール**: admin@test.com
- **パスワード**: [設定する]
- **権限**: 全機能アクセス可

### 2.2 整体師アカウント
- **メール**: therapist1@test.com
- **パスワード**: [設定する]
- **権限**: 整体師機能

### 2.3 法人担当者アカウント
- **メール**: company1@test.com
- **パスワード**: [設定する]
- **所属法人**: テスト株式会社

---

## 3. 機能テスト

### 3.1 認証機能

#### TC-AUTH-001: ログイン（正常系）
**目的**: 正しい認証情報でログインできることを確認
**手順**:
1. ログインページにアクセス
2. 有効なメールアドレスとパスワードを入力
3. 「ログイン」ボタンをクリック

**期待結果**:
- ✅ ダッシュボードにリダイレクトされる
- ✅ ユーザー名が表示される
- ✅ 役割に応じたメニューが表示される

#### TC-AUTH-002: ログイン（異常系）
**目的**: 不正な認証情報でログインできないことを確認
**手順**:
1. ログインページにアクセス
2. 無効なメールアドレスまたはパスワードを入力
3. 「ログイン」ボタンをクリック

**期待結果**:
- ✅ エラーメッセージが表示される
- ✅ ログインページに留まる

#### TC-AUTH-003: 初回ログイン時のパスワード変更
**目的**: 初回ログイン時にパスワード変更を強制されることを確認
**手順**:
1. 新規作成された法人担当者アカウントでログイン
2. パスワード変更画面が表示される
3. 新しいパスワードを入力して変更

**期待結果**:
- ✅ パスワード変更画面が強制表示される
- ✅ 変更後にダッシュボードにアクセスできる

---

### 3.2 管理者機能

#### TC-ADMIN-001: 法人登録
**目的**: 新しい法人を登録できることを確認
**手順**:
1. 管理者でログイン
2. 「法人管理」→「新規法人登録」
3. 法人情報を入力（名前、住所、電話番号、メール）
4. 「登録」ボタンをクリック

**期待結果**:
- ✅ 成功メッセージが表示される→〇
- ✅ 法人一覧に新しい法人が表示される→〇

#### TC-ADMIN-002: 法人担当者登録
**目的**: 法人担当者を登録できることを確認
**手順**:
1. 管理者でログイン
2. 法人詳細ページにアクセス
3. 「新規担当者登録」ボタンをクリック
4. 担当者情報を入力（氏名、メール、電話番号）
5. 「登録」ボタンをクリック

**期待結果**:limitgym.yotsuya@gmail.com
- ✅ 成功メッセージが表示される→〇
- ✅ 初期パスワードが発行される→〇　fd#S+XT4YH&R
- ✅ 担当者にメールが送信される→×　これは管理者から伝える

法人担当者へ伝える内容
1. ログインURL: https://your-app-url.com/login
2. メールアドレス: limitgym.yotsuya@gmail.com
3. 初期パスワード: fd#S+XT4YH&R


#### TC-ADMIN-003: 整体師登録
**目的**: 整体師を登録できることを確認
**手順**:
1. 管理者でログイン
2. 「整体師管理」→「新規整体師登録」
3. 整体師情報を入力（氏名、メール、免許番号、専門分野）
4. 「登録」ボタンをクリック

**期待結果**:
- ✅ 成功メッセージが表示される→×予期しないエラー発生。重複のメールアドレスか？→〇修正した。重複エラー。管理者、整体師として登録ない限り重複もok
- ✅ 整体師一覧に新しい整体師が表示される→〇

#### TC-ADMIN-004: 施術メニュー管理
**目的**: 施術メニューを作成・編集・無効化できることを確認
**手順**:
1. 管理者でログイン
2. 「施術メニュー管理」にアクセス
3. 「新規メニュー追加」をクリック
4. メニュー情報を入力（名前、時間、料金、説明）
5. 「登録」ボタンをクリック

**期待結果**:
- ✅ 成功メッセージが表示される→〇
- ✅ メニュー一覧に新しいメニューが表示される→〇
- ✅ 編集・無効化ができる→〇

#### TC-ADMIN-005: 症状マスター管理
**目的**: 症状を追加・編集できることを確認
**手順**:
1. 管理者でログイン
2. 「症状マスター」にアクセス
3. 「新規症状追加」をクリック
4. 症状名を入力
5. 「登録」ボタンをクリック

**期待結果**:
- ✅ 成功メッセージが表示される→〇　成功メッセージが英語
- ✅ 症状一覧に新しい症状が表示される→〇

#### TC-ADMIN-006: 予約承認（管理者代理）
**目的**: 管理者が整体師の代わりに予約を承認できることを確認
**手順**:
1. 管理者でログイン
2. 「予約承認・管理」にアクセス
3. 承認待ちの予約を選択
4. 「承認」ボタンをクリック
5. 確認ダイアログで「承認する」をクリック

**期待結果**:
- ✅ 予約が承認される→〇
- ✅ 法人担当者に通知が送信される
- ✅ 空き枠のステータスが「booked」に変更される→〇　気付き。予約承認がきていたときに、承認・拒否の処理をどう警告するか。ダッシュボードに追加した。

#### TC-ADMIN-007: 予約拒否（管理者代理）
**目的**: 管理者が整体師の代わりに予約を拒否できることを確認
**手順**:
1. 管理者でログイン
2. 「予約承認・管理」にアクセス
3. 承認待ちの予約を選択
4. 「拒否」ボタンをクリック
5. 拒否理由を入力
6. 「拒否する」ボタンをクリック

**期待結果**:
- ✅ 予約が拒否される→〇
- ✅ 拒否理由が記録される→〇
- ✅ 法人担当者に通知が送信される→〇
- ✅ 空き枠が再度「available」に戻る→〇

---

### 3.3 整体師機能

#### TC-THERAPIST-001: 空き枠登録
**目的**: 整体師が空き枠を登録できることを確認
**手順**:
1. 整体師でログイン
2. 「空き枠管理」→「新規登録」
3. 日付、開始時刻、施術メニューを選択
4. 「登録」ボタンをクリック

**期待結果**:
- ✅ 成功メッセージが表示される→〇
- ✅ カレンダーに空き枠が表示される→〇
- ✅ 終了時刻が自動計算される→〇
- ✅ 過去の日付は登録できずエラーメッセージが表示される→〇

#### TC-THERAPIST-002: 空き枠登録（時間不一致エラー）
**目的**: 施術メニューと時間帯が一致しない場合にエラーになることを確認
**手順**:
1. 整体師でログイン
2. カレンダーで15分の時間枠を選択
3. 60分の施術メニューを選択
4. 「登録」ボタンをクリック

**期待結果**:
- ✅ エラーメッセージが表示される
- ✅ 「選択した時間帯とメニューの時間が一致しません」と警告される
- ✅ 登録されない

#### TC-THERAPIST-003: 空き枠削除
**目的**: 予約がない空き枠を削除できることを確認
**手順**:
1. 整体師でログイン
2. 空き枠一覧から削除したい枠を選択
3. 「削除」ボタンをクリック
4. 確認ダイアログで「削除」を選択

**期待結果**:
- ✅ 成功メッセージが表示される
- ✅ 空き枠が一覧から削除される

#### TC-THERAPIST-004: 予約済み空き枠の削除（エラー）
**目的**: 予約がある空き枠を削除できないことを確認
**手順**:
1. 整体師でログイン
2. 予約済みの空き枠を選択
3. 「削除」ボタンをクリック

**期待結果**:
- ✅ エラーメッセージが表示される
- ✅ 「予約済みの空き枠は削除できません」と警告される

#### TC-THERAPIST-005: 予約承認
**目的**: 整体師が予約を承認できることを確認
**手順**:
1. 整体師でログイン
2. 「予約管理」にアクセス
3. 承認待ちの予約を選択
4. 「承認」ボタンをクリック
5. 確認ダイアログで「承認する」をクリック

**期待結果**:
- ✅ 予約が承認される
- ✅ 法人担当者に通知が送信される
- ✅ ステータスが「approved」に変更される

#### TC-THERAPIST-006: 予約拒否
**目的**: 整体師が予約を拒否できることを確認
**手順**:
1. 整体師でログイン
2. 「予約管理」にアクセス
3. 承認待ちの予約を選択
4. 「拒否」ボタンをクリック
5. 拒否理由を入力
6. 「拒否する」ボタンをクリック

**期待結果**:
- ✅ 予約が拒否される
- ✅ 拒否理由が記録される
- ✅ 法人担当者に通知が送信される

#### TC-THERAPIST-007: 施術後レポート記入
**目的**: 施術完了後にレポートを記入できることを確認
**手順**:
1. 整体師でログイン
2. 完了した予約の詳細ページにアクセス
3. 「施術レポート記入」をクリック
4. 施術内容、顧客の状態、症状、改善度、満足度、実際の施術時間、次回の提案を入力
5. 「記録」ボタンをクリック

**期待結果**:
- ✅ 成功メッセージが表示される
- ✅ ステータスが「completed」に変更される
- ✅ 施術履歴に記録される

#### TC-THERAPIST-008: 全体スケジュール閲覧
**目的**: 整体師が全整体師のスケジュールを閲覧できることを確認
**手順**:
1. 整体師でログイン
2. 「全体スケジュール」にアクセス
3. カレンダー表示を確認

**期待結果**:
- ✅ 全整体師の予約が表示される
- ✅ 整体師ごとに色分けされている
- ✅ ステータスごとに色分けされている

---

### 3.4 法人担当者機能

#### TC-COMPANY-001: 予約申込
**目的**: 法人担当者が予約を申し込めることを確認
**手順**:
1. 法人担当者でログイン
2. 「スケジュール」から空き枠を選択
3. 社員名、社員ID、症状、要望を入力
4. 「申込」ボタンをクリック

**期待結果**:
- ✅ 成功メッセージが表示される
- ✅ 予約一覧に申込が表示される（ステータス: pending）
- ✅ 整体師に通知が送信される

#### TC-COMPANY-002: 予約申込（必須項目未入力）
**目的**: 必須項目が未入力の場合にエラーになることを確認
**手順**:
1. 法人担当者でログイン
2. 「スケジュール」から空き枠を選択
3. 社員名のみ入力（社員IDを空欄）
4. 「申込」ボタンをクリック

**期待結果**:
- ✅ エラーメッセージが表示される
- ✅ 「必須項目を入力してください」と警告される

#### TC-COMPANY-003: 予約キャンセル（期限内）
**目的**: 前日20時までに予約をキャンセルできることを確認
**手順**:
1. 法人担当者でログイン
2. 予約一覧から明日以降の予約を選択
3. 「キャンセル」ボタンをクリック
4. 確認ダイアログで「キャンセル」を選択

**期待結果**:
- ✅ 予約がキャンセルされる
- ✅ 空き枠が再度「available」に戻る
- ✅ 整体師に通知が送信される

#### TC-COMPANY-004: 予約キャンセル（期限切れ）
**目的**: 前日20時を過ぎた予約をキャンセルできないことを確認
**手順**:
1. 法人担当者でログイン
2. 予約一覧から明日の予約を選択（現在時刻が前日20時以降と仮定）
3. 「キャンセル」ボタンを確認

**期待結果**:
- ✅ 「キャンセル」ボタンが無効化される
- ✅ 「キャンセル期限を過ぎています」と表示される

#### TC-COMPANY-005: 自社の施術履歴閲覧
**目的**: 自社の施術履歴のみ閲覧できることを確認
**手順**:
1. 法人担当者でログイン
2. 「施術履歴」にアクセス
3. 一覧を確認

**期待結果**:
- ✅ 自社の施術履歴のみ表示される
- ✅ 他社の履歴は表示されない

#### TC-COMPANY-006: 今月の利用状況確認
**目的**: 今月の利用状況を確認できることを確認
**手順**:
1. 法人担当者でログイン
2. ダッシュボードで今月の利用状況を確認

**期待結果**:
- ✅ 今月の予約件数が表示される
- ✅ 利用した社員数が表示される
- ✅ 次回予約情報が表示される

---

### 3.5 通知機能

#### TC-NOTIFICATION-001: 予約申込通知（整体師宛）
**目的**: 予約申込時に整体師に通知が送信されることを確認
**手順**:
1. 法人担当者で予約を申し込む
2. 整体師アカウントで確認

**期待結果**:
- ✅ アプリ内通知が表示される
- ✅ メール通知が送信される
- ✅ 通知内容に予約詳細が含まれる

#### TC-NOTIFICATION-002: 予約承認通知（法人担当者宛）
**目的**: 予約承認時に法人担当者に通知が送信されることを確認
**手順**:
1. 整体師で予約を承認する
2. 法人担当者アカウントで確認

**期待結果**:
- ✅ アプリ内通知が表示される
- ✅ メール通知が送信される
- ✅ 通知内容に予約詳細が含まれる

#### TC-NOTIFICATION-003: 予約拒否通知（法人担当者宛）
**目的**: 予約拒否時に法人担当者に通知が送信されることを確認
**手順**:
1. 整体師で予約を拒否する（拒否理由を入力）
2. 法人担当者アカウントで確認

**期待結果**:
- ✅ アプリ内通知が表示される
- ✅ メール通知が送信される
- ✅ 通知内容に拒否理由が含まれる

---

### 3.6 検索・フィルター機能

#### TC-SEARCH-001: 予約検索（社員名）
**目的**: 社員名で予約を検索できることを確認
**手順**:
1. 管理者でログイン
2. 「予約管理」にアクセス
3. 検索ボックスに社員名を入力
4. 「検索」ボタンをクリック

**期待結果**:
- ✅ 該当する予約のみ表示される
- ✅ 部分一致で検索される

#### TC-SEARCH-002: 予約フィルター（ステータス）
**目的**: ステータスで予約をフィルターできることを確認
**手順**:
1. 管理者でログイン
2. 「予約管理」にアクセス
3. ステータスドロップダウンで「承認待ち」を選択
4. 「検索」ボタンをクリック

**期待結果**:
- ✅ 承認待ちの予約のみ表示される

#### TC-SEARCH-003: 予約フィルター（日付範囲）
**目的**: 日付範囲で予約をフィルターできることを確認
**手順**:
1. 管理者でログイン
2. 「予約管理」にアクセス
3. 開始日と終了日を選択
4. 「検索」ボタンをクリック

**期待結果**:
- ✅ 指定した日付範囲の予約のみ表示される

---

## 4. 統合テスト

### 4.1 予約フロー全体テスト

#### TC-INTEGRATION-001: 予約申込から施術完了まで
**目的**: 予約の全フローが正常に動作することを確認
**手順**:
1. 整体師が空き枠を登録
2. 法人担当者が予約を申し込む
3. 整体師が予約を承認
4. 施術日になったら整体師が施術レポートを記入
5. 法人担当者が施術履歴を確認

**期待結果**:
- ✅ 各ステップで適切な通知が送信される
- ✅ ステータスが正しく遷移する
- ✅ データが正しく記録される

#### TC-INTEGRATION-002: 予約拒否フロー
**目的**: 予約拒否フローが正常に動作することを確認
**手順**:
1. 整体師が空き枠を登録
2. 法人担当者が予約を申し込む
3. 整体師が予約を拒否（理由を入力）
4. 法人担当者が通知を確認
5. 再度同じ枠で予約を申し込む

**期待結果**:
- ✅ 拒否後に空き枠が再度利用可能になる
- ✅ 拒否理由が記録される
- ✅ 再予約が可能

---

## 5. セキュリティテスト

### 5.1 権限テスト

#### TC-SECURITY-001: 法人担当者が他社データにアクセスできないこと
**目的**: Row Level Securityが正しく機能することを確認
**手順**:
1. 法人担当者Aでログイン
2. 法人Bの予約URLに直接アクセス

**期待結果**:
- ✅ アクセスが拒否される
- ✅ エラーメッセージが表示される

#### TC-SECURITY-002: 整体師が他の整体師の空き枠を削除できないこと
**目的**: 権限チェックが正しく機能することを確認
**手順**:
1. 整体師Aでログイン
2. 整体師Bの空き枠の削除URLに直接アクセス

**期待結果**:
- ✅ 削除が拒否される
- ✅ エラーメッセージが表示される

#### TC-SECURITY-003: 法人担当者が管理者機能にアクセスできないこと
**目的**: 役割ベースのアクセス制御が機能することを確認
**手順**:
1. 法人担当者でログイン
2. 管理者専用URLに直接アクセス（例: /admin/companies）

**期待結果**:
- ✅ アクセスが拒否される
- ✅ ダッシュボードにリダイレクトされる

---

### 5.2 入力検証テスト

#### TC-SECURITY-004: SQLインジェクション対策
**目的**: SQLインジェクション攻撃を防げることを確認
**手順**:
1. 検索フォームに `' OR '1'='1` を入力
2. 検索を実行

**期待結果**:
- ✅ エラーが発生しない
- ✅ 不正なデータが取得されない

#### TC-SECURITY-005: XSS対策
**目的**: クロスサイトスクリプティング攻撃を防げることを確認
**手順**:
1. 要望欄に `<script>alert('XSS')</script>` を入力
2. 送信後に表示を確認

**期待結果**:
- ✅ スクリプトが実行されない
- ✅ エスケープされて表示される

---

## 6. パフォーマンステスト

### 6.1 ページ読み込み速度

#### TC-PERFORMANCE-001: ダッシュボードの読み込み速度
**目的**: ダッシュボードが2秒以内に読み込まれることを確認
**手順**:
1. ブラウザの開発者ツールを開く
2. ダッシュボードにアクセス
3. 読み込み時間を計測

**期待結果**:
- ✅ 2秒以内に読み込まれる

#### TC-PERFORMANCE-002: カレンダーの読み込み速度
**目的**: カレンダーが100件のイベントでも快適に動作することを確認
**手順**:
1. 100件以上の空き枠を登録
2. スケジュールページにアクセス
3. 読み込み時間を計測

**期待結果**:
- ✅ 3秒以内に読み込まれる
- ✅ スクロールがスムーズ

---

## 7. ユーザビリティテスト

### 7.1 UI/UX確認

#### TC-USABILITY-001: ボタン配置の統一性
**目的**: 主要アクションボタンが左側に配置されていることを確認
**確認ページ**:
- 法人登録ページ
- 整体師登録ページ
- 施術メニュー登録ページ
- 予約申込ページ
- 整体師情報編集ページ
- 法人担当者編集ページ

**期待結果**:
- ✅ すべてのページで主要ボタンが左側にある
- ✅ キャンセルボタンが右側にある

#### TC-USABILITY-002: モーダルの背景色
**目的**: モーダルの背景が柔らかいグレーであることを確認
**確認モーダル**:
- 管理者予約承認ダイアログ
- 管理者予約拒否ダイアログ
- 整体師予約承認ダイアログ
- 整体師予約拒否ダイアログ

**期待結果**:
- ✅ 背景が黒ではなくグレー（bg-gray-500 bg-opacity-25）
- ✅ ぼかし効果がある

#### TC-USABILITY-003: エラーメッセージの明確性
**目的**: エラーメッセージが日本語で分かりやすいことを確認
**手順**:
1. 各フォームで意図的にエラーを発生させる
2. エラーメッセージを確認

**期待結果**:
- ✅ 日本語で表示される
- ✅ 具体的な対処方法が示される

---

## 8. テスト実施チェックリスト

### 8.1 機能テスト
- [ ] TC-AUTH-001: ログイン（正常系）
- [ ] TC-AUTH-002: ログイン（異常系）
- [ ] TC-AUTH-003: 初回パスワード変更
- [ ] TC-ADMIN-001: 法人登録
- [ ] TC-ADMIN-002: 法人担当者登録
- [ ] TC-ADMIN-003: 整体師登録
- [ ] TC-ADMIN-004: 施術メニュー管理
- [ ] TC-ADMIN-005: 症状マスター管理
- [ ] TC-ADMIN-006: 予約承認（管理者代理）
- [ ] TC-ADMIN-007: 予約拒否（管理者代理）
- [ ] TC-THERAPIST-001: 空き枠登録
- [ ] TC-THERAPIST-002: 空き枠登録（時間不一致エラー）
- [ ] TC-THERAPIST-003: 空き枠削除
- [ ] TC-THERAPIST-004: 予約済み空き枠の削除（エラー）
- [ ] TC-THERAPIST-005: 予約承認
- [ ] TC-THERAPIST-006: 予約拒否
- [ ] TC-THERAPIST-007: 施術後レポート記入
- [ ] TC-THERAPIST-008: 全体スケジュール閲覧
- [ ] TC-COMPANY-001: 予約申込
- [ ] TC-COMPANY-002: 予約申込（必須項目未入力）
- [ ] TC-COMPANY-003: 予約キャンセル（期限内）
- [ ] TC-COMPANY-004: 予約キャンセル（期限切れ）
- [ ] TC-COMPANY-005: 自社の施術履歴閲覧
- [ ] TC-COMPANY-006: 今月の利用状況確認

### 8.2 統合テスト
- [ ] TC-INTEGRATION-001: 予約申込から施術完了まで
- [ ] TC-INTEGRATION-002: 予約拒否フロー

### 8.3 セキュリティテスト
- [ ] TC-SECURITY-001: 法人担当者が他社データにアクセスできない
- [ ] TC-SECURITY-002: 整体師が他の整体師の空き枠を削除できない
- [ ] TC-SECURITY-003: 法人担当者が管理者機能にアクセスできない
- [ ] TC-SECURITY-004: SQLインジェクション対策
- [ ] TC-SECURITY-005: XSS対策

### 8.4 パフォーマンステスト
- [ ] TC-PERFORMANCE-001: ダッシュボードの読み込み速度
- [ ] TC-PERFORMANCE-002: カレンダーの読み込み速度

### 8.5 ユーザビリティテスト
- [ ] TC-USABILITY-001: ボタン配置の統一性
- [ ] TC-USABILITY-002: モーダルの背景色
- [ ] TC-USABILITY-003: エラーメッセージの明確性

---

## 9. バグ報告テンプレート

### バグ報告フォーマット
```
【バグID】: BUG-XXX
【発見日】: YYYY-MM-DD
【優先度】: 高 / 中 / 低
【カテゴリ】: 機能 / UI / パフォーマンス / セキュリティ
【発生環境】: ブラウザ名、OS、デバイス
【再現手順】:
1.
2.
3.

【期待される動作】:

【実際の動作】:

【スクリーンショット】: （添付）

【その他】:
```

---

## 10. テスト完了基準

### 10.1 合格基準
- ✅ すべての機能テストケースが合格
- ✅ セキュリティテストケースが合格
- ✅ パフォーマンステストケースが合格
- ✅ 致命的なバグが0件
- ✅ 高優先度バグが修正済み

### 10.2 リリース判定
- すべてのテストケースが合格した場合、本番リリース可能
- 中優先度バグは次回リリースで修正可能

---

**作成者**: AI開発支援
**承認者**: 中川利右司（Lead off Health 整体院）
**最終更新日**: 2025年1月23日
