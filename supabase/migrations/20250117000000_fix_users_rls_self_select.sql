-- ============================================================================
-- usersテーブルに自分自身の情報を読み取るRLSポリシーを追加
-- ============================================================================
-- 問題: employeeユーザーがログイン後にusersテーブルから自分の情報を読み取れない
-- 原因: usersテーブルのSELECTポリシーが管理者のみに限定されている
-- 解決: 全ユーザーが自分自身のレコードを読み取れるポリシーを追加
-- ============================================================================

-- 全ユーザーが自分自身の情報を閲覧可能にするポリシーを追加
CREATE POLICY "Users can view their own profile"
  ON public.users FOR SELECT
  USING (id = auth.uid());

-- 既存のポリシー:
-- 1. "管理者は全ユーザー情報を閲覧可能" (admin roleのみ)
-- 2. "Users can view their own profile" (全ユーザー、新規追加)
-- これで、employeeを含む全ユーザーが自分のmust_change_passwordフラグを読み取れるようになります
